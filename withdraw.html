<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Withdraw</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f3f3f3;}
.header{background:#5e239d;color:#fff;text-align:center;padding:14px;font-size:20px;}
.card{background:#5e239d;color:white;margin:15px;border-radius:15px;padding:15px;display:flex;justify-content:space-between;}
.box{background:white;margin:15px;border-radius:15px;padding:20px;text-align:center;}
.input{width:100%;padding:14px;margin:10px 0;border-radius:30px;border:1px solid #ccc;font-size:16px;}
.btn{width:100%;background:#5e239d;color:white;padding:14px;border:none;border-radius:30px;font-size:18px;margin-top:10px;}
.note{font-size:14px;margin-top:8px;color:#444;}
.rules{margin:15px;background:#f9f9f9;border-radius:14px;padding:15px;font-size:14px;line-height:1.6;color:#555;}
.rules div{margin-top:6px;}
.rules span{color:red;}

/* ðŸ”¹ NEW */
.tabs{display:flex;gap:10px;margin-bottom:10px;}
.tab{flex:1;padding:12px;border:none;border-radius:20px;font-weight:bold;background:#eee;}
.tab.active{background:#5e239d;color:white;}
</style>
</head>

<body>

<div class="header">RozanaCash</div>

<div class="card">
  <div>Wallet â‚¹<span id="wallet">0</span></div>
  <div>Winning â‚¹<span id="winning">0</span></div>
</div>

<div class="box">

  <!-- ðŸ”¹ NEW TABS -->
  <div class="tabs">
    <button class="tab active" id="upiTab">UPI</button>
    <button class="tab" id="bankTab">BANK</button>
  </div>

  <!-- ================= UPI FORM (OLD â€“ UNTOUCHED) ================= -->
  <div id="upiForm">
    <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/UPI-Logo.png" width="80"><br><br>
    <input class="input" id="upi" placeholder="Enter UPI ID">
    <input class="input" id="amount" type="number" placeholder="Enter Amount">
  </div>

  <!-- ================= BANK FORM (NEW) ================= -->
  <div id="bankForm" style="display:none">
    <input class="input" id="accName" placeholder="Account Holder Name">
    <input class="input" id="accNo" placeholder="Account Number">
    <input class="input" id="ifsc" placeholder="IFSC Code">
    <input class="input" id="bankName" placeholder="Bank Name">
    <input class="input" id="bankAmount" type="number" placeholder="Enter Amount">
  </div>

  <div class="note">Minimum withdraw â‚¹1000</div>
  <button class="btn" id="withdrawBtn">Withdraw</button>
</div>

<!-- RULES (OLD) -->
<div class="rules">
  <div>ðŸ”´ <b>Withdraw time</b> <span>00:05 - 23:55</span></div>
  <div>ðŸ”´ <b>In-day Remaining Withdrawal Times</b> <span id="remainTimes">3</span></div>
  <div>ðŸ”´ <b>Withdrawal amount range</b> <span>â‚¹1,000 â€“ â‚¹50,000</span></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, addDoc, collection, updateDoc, increment }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyBudDcoi0ybnrLpifDJGxYxfdF3eoSpDxM",
 authDomain:"earncash7-f0ecc.firebaseapp.com",
 projectId:"earncash7-f0ecc",
 appId:"1:1017767289580:web:56ecbedc90fe167d3dbbc9"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let userRef, withdrawControl;
let mode="UPI"; // ðŸ”¹ NEW

function today(){
 const d=new Date();
 return d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
}

onAuthStateChanged(auth, async(user)=>{
 if(!user){location.href="index.html";return;}
 userRef=doc(db,"users",user.uid);
 const snap=await getDoc(userRef);
 wallet.innerText=snap.data().balance;
 winning.innerText=snap.data().totalEarned;

 const cSnap=await getDoc(doc(db,"admin","withdrawControl"));
 withdrawControl=cSnap.data();

 let count=snap.data().withdrawCount||0;
 let last=snap.data().lastWithdrawDate||"";
 if(last!==today()) count=0;
 remainTimes.innerText=withdrawControl.dailyLimit-count;
});

// ðŸ”¹ TAB SWITCH
upiTab.onclick=()=>{mode="UPI";upiForm.style.display="block";bankForm.style.display="none";upiTab.classList.add("active");bankTab.classList.remove("active");};
bankTab.onclick=()=>{mode="BANK";upiForm.style.display="none";bankForm.style.display="block";bankTab.classList.add("active");upiTab.classList.remove("active");};

withdrawBtn.onclick=async()=>{
 const snap=await getDoc(userRef);
 let user=snap.data();

 let amt = mode==="UPI"?Number(amount.value):Number(bankAmount.value);
 if(!amt || amt<withdrawControl.minWithdraw) return alert("âŒ Invalid amount");
 if(user.totalEarned<amt) return alert("âŒ Insufficient winning");

 let data={method:mode,amount:amt,status:"Pending",uid:auth.currentUser.uid,email:auth.currentUser.email,createdAt:new Date()};

 if(mode==="UPI"){
  if(!upi.value) return alert("Enter UPI ID");
  data.upi=upi.value;
 }else{
  if(!accNo.value||!ifsc.value) return alert("Enter bank details");
  data.bank={name:accName.value,acc:accNo.value,ifsc:ifsc.value,bank:bankName.value};
 }

 await addDoc(collection(db,"withdrawRequests"),data);
 await updateDoc(userRef,{totalEarned:increment(-amt),withdrawCount:increment(1),lastWithdrawDate:today()});

 alert("âœ… Withdraw request submitted");
 location.reload();
};
</script>

</body>
</html>
