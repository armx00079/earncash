<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel â€“ RozanaCash</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f4f6f8;
}
.header{
  background:#5e239d;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:20px;
}
.sub{
  text-align:center;
  font-size:14px;
  color:#555;
  margin:10px 0;
}
.admin-stats{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
  margin:15px;
}
.stat-card{
  background:#e9f7ef;
  border-left:6px solid #27ae60;
  padding:12px;
  font-weight:bold;
  border-radius:8px;
  color:#1e8449;
}
.section{
  background:#fff;
  margin:15px;
  padding:15px;
  border-radius:12px;
}
.req{
  border-bottom:1px solid #eee;
  padding:10px 0;
}
.req:last-child{border:none}
.btn{
  padding:6px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-right:6px;
}
.approve{background:#6f2dbd;color:#fff}
.reject{background:#e74c3c;color:#fff}
.logout{
  background:#e53935;
  color:#fff;
  border:none;
  width:90%;
  margin:20px auto;
  display:block;
  padding:12px;
  border-radius:10px;
  font-size:16px;
}
</style>
</head>

<body>

<div class="header">ğŸ” Admin Panel</div>
<div class="sub">Admin-only secure control panel</div>

<div class="admin-stats">
  <div class="stat-card">âœ”ï¸ Withdraw Approve / Reject</div>
  <div class="stat-card">âœ”ï¸ Wallet Auto Update</div>
  <div class="stat-card">âœ”ï¸ 100% Firebase Secure</div>
  <div class="stat-card">âœ”ï¸ GitHub Pages Compatible</div>
</div>

<div class="section">
  <h3>ğŸ’° Deposit Requests</h3>
  <div id="depositList">Loading...</div>
</div>

<div class="section">
  <h3>ğŸ§ Withdraw Requests</h3>
  <div id="withdrawList">Loading...</div>
</div>

<button class="logout" id="logoutBtn">Logout</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, increment, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBudDcoi0ybnrLpifDJGxYxfdF3eoSpDxM",
  authDomain: "earncash7-f0ecc.firebaseapp.com",
  projectId: "earncash7-f0ecc",
  appId: "1:1017767289580:web:56ecbedc90fe167d3dbbc9"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async(user)=>{
  if(!user){location.href="index.html";return;}
  const uref = doc(db,"users",user.uid);
  const snap = await getDoc(uref);
  if(!snap.exists() || snap.data().role!=="admin"){
    alert("Access denied");
    location.href="dashboard.html";
  }
  loadDeposits();
  loadWithdraws();
});

async function loadDeposits(){
  const list = document.getElementById("depositList");
  list.innerHTML="";
  const q = await getDocs(collection(db,"depositRequests"));
  if(q.empty){list.innerHTML="No requests";return;}
  q.forEach(d=>{
    const r=d.data();
    list.innerHTML+=`
    <div class="req">
      <b>User:</b> ${r.email}<br>
      <b>Amount:</b> â‚¹${r.amount}<br><br>
      <button class="btn approve" onclick="approveDeposit('${d.id}','${r.uid}',${r.amount})">Approve</button>
      <button class="btn reject" onclick="rejectDeposit('${d.id}')">Reject</button>
    </div>`;
  });
}

async function loadWithdraws(){
  const list = document.getElementById("withdrawList");
  list.innerHTML="";
  const q = await getDocs(collection(db,"withdrawRequests"));
  if(q.empty){list.innerHTML="No requests";return;}
  q.forEach(d=>{
    const r=d.data();
    list.innerHTML+=`
    <div class="req">
      <b>User:</b> ${r.email}<br>
      <b>Amount:</b> â‚¹${r.amount}<br><br>
      <button class="btn approve" onclick="approveWithdraw('${d.id}')">Approve</button>
      <button class="btn reject" onclick="rejectWithdraw('${d.id}')">Reject</button>
    </div>`;
  });
}

window.approveDeposit = async(id,uid,amt)=>{
  await updateDoc(doc(db,"users",uid),{balance:increment(amt)});
  await deleteDoc(doc(db,"depositRequests",id));
  alert("Deposit approved");
  loadDeposits();
};

window.rejectDeposit = async(id)=>{
  await deleteDoc(doc(db,"depositRequests",id));
  loadDeposits();
};

window.approveWithdraw = async(id)=>{
  await deleteDoc(doc(db,"withdrawRequests",id));
  alert("Withdraw approved");
  loadWithdraws();
};

window.rejectWithdraw = async(id)=>{
  await deleteDoc(doc(db,"withdrawRequests",id));
  loadWithdraws();
};

document.getElementById("logoutBtn").onclick=()=>{
  signOut(auth).then(()=>location.href="index.html");
};
</script>

</body>
</html>
