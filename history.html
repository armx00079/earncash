<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>My History</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body{
      margin:0;
      font-family: Arial;
      background:#f4f6f8;
    }
    header{
      background:#5e239d;
      color:#fff;
      padding:15px;
      text-align:center;
      font-size:20px;
    }
    .box{
      background:#fff;
      margin:15px;
      padding:15px;
      border-radius:10px;
      box-shadow:0 4px 10px rgba(0,0,0,.1);
    }
    h3{
      margin-top:0;
      color:#333;
    }
    .item{
      border-bottom:1px solid #eee;
      padding:8px 0;
      font-size:14px;
    }
    .status{
      font-weight:bold;
    }
    .approved{color:green;}
    .pending{color:orange;}
    .rejected{color:red;}
    button{
      width:90%;
      margin:20px auto;
      display:block;
      padding:12px;
      border:none;
      border-radius:6px;
      background:#e53935;
      color:#fff;
      font-size:16px;
    }
  </style>
</head>

<body>

<header>üìú My History</header>

<div class="box">
  <h3>üí∞ Deposit History</h3>
  <div id="depositList">Loading...</div>
</div>

<div class="box">
  <h3>üèß Withdrawal History</h3>
  <div id="withdrawList">Loading...</div>
</div>

<button onclick="location.href='spin.html'">‚¨Ö Back</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBudDcoi0ybnrLpifDJGxYxfdF3eoSpDxM",
    authDomain: "earncash7-f0ecc.firebaseapp.com",
    projectId: "earncash7-f0ecc",
    appId: "1:1017767289580:web:56ecbedc90fe167d3dbbc9"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  onAuthStateChanged(auth, async(user)=>{
    if(!user){
      location.href="index.html";
      return;
    }

    // üîπ Deposits
    const dQuery = query(
      collection(db,"depositReq"),
      where("uid","==",user.uid)
    );
    const dSnap = await getDocs(dQuery);
    let dHtml="";
    dSnap.forEach(doc=>{
      const d=doc.data();
      dHtml+=`
        <div class="item">
          ‚Çπ${d.amount} -
          <span class="status ${d.status}">
            ${d.status}
          </span>
        </div>`;
    });
    document.getElementById("depositList").innerHTML =
      dHtml || "No deposits found";

    // üîπ Withdrawals
    const wQuery = query(
      collection(db,"withdrawReq"),
      where("uid","==",user.uid)
    );
    const wSnap = await getDocs(wQuery);
    let wHtml="";
    wSnap.forEach(doc=>{
      const w=doc.data();
      wHtml+=`
        <div class="item">
          ‚Çπ${w.amount} -
          <span class="status ${w.status}">
            ${w.status}
          </span>
        </div>`;
    });
    document.getElementById("withdrawList").innerHTML =
      wHtml || "No withdrawals found";
  });
</script>

</body>
</html>
