<!DOCTYPE html>
<html>
<head>
<title>Deposit</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f2f2f2}
.header{background:#5e239d;color:white;text-align:center;padding:15px;font-size:20px}
.box{
  background:white;
  margin:20px;
  border-radius:15px;
  padding:20px;
  text-align:center;
}
.btn{
  background:#5e239d;
  color:white;
  border:none;
  padding:14px 30px;
  border-radius:30px;
  font-size:16px;
}
</style>
</head>

<body>
<div class="header">Add Money</div>

<div class="box">
  <h3>Amount: ₹<span id="amt"></span></h3>
  <p>Scan & Pay</p>
  <img id="qr" width="220"><br><br>
  <a id="upiBtn"><button class="btn">Pay via UPI App</button></a>
  <br><br>
  <button onclick="submit()" class="btn">Payment Done</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore,addDoc,collection,serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyBudDcoi0ybnrLpifDJGxYxfdF3eoSpDxM",
  authDomain:"earncash7-f0ecc.firebaseapp.com",
  projectId:"earncash7-f0ecc",
  appId:"1:1017767289580:web:56ecbedc90fe167d3dbbc9"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const params=new URLSearchParams(location.search);
const amount=params.get("amount");
const spins=params.get("spins");

document.getElementById("amt").innerText=amount;

const upi="upi://pay?pa=8302299569@ybl&pn=RozanaCash&am="+amount+"&cu=INR";

document.getElementById("upiBtn").href=upi;
document.getElementById("qr").src=
`https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(upi)}`;

let currentUser;

onAuthStateChanged(auth,u=>{
  if(!u) location.href="index.html";
  currentUser=u;
});

window.submit=async()=>{
  await addDoc(collection(db,"deposits"),{
    uid:currentUser.uid,
    amount:Number(amount),
    spins:Number(spins),
    status:"pending",
    createdAt:serverTimestamp()
  });
  alert("✅ Payment submitted. Spins added after admin approval.");
  location.href="dashboard.html";
};
</script>

</body>
</html>
