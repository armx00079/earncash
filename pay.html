<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pay via UPI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f3f3f3;
}
.header{
  background:#5e239d;
  color:white;
  text-align:center;
  padding:15px;
  font-size:20px;
}
.card{
  background:white;
  margin:20px;
  border-radius:15px;
  padding:20px;
  text-align:center;
}
.btn{
  background:#5e239d;
  color:white;
  border:none;
  padding:14px 30px;
  border-radius:30px;
  font-size:16px;
  margin-top:12px;
}
</style>
</head>

<body>

<div class="header">Add Money</div>

<div class="card">
  <h2>Amount: ₹<span id="amt"></span></h2>
  <p>Scan & Pay</p>

  <img id="qr" width="240">

  <br>
  <button class="btn" onclick="payUpi()">Pay via UPI App</button>
  <br>
  <button class="btn" onclick="done()">Payment Done</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBudDcoi0ybnrLpifDJGxYxfdF3eoSpDxM",
  authDomain: "earncash7-f0ecc.firebaseapp.com",
  projectId: "earncash7-f0ecc",
  appId: "1:1017767289580:web:56ecbedc90fe167d3dbbc9"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const params = new URLSearchParams(location.search);
const amount = params.get("amount");
const spins = params.get("spins");

document.getElementById("amt").innerText = amount;

// QR generate
const upi = `upi://pay?pa=8302299569@ybl&pn=RozanaCash&am=${amount}&cu=INR`;
document.getElementById("qr").src =
`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(upi)}`;

window.payUpi = ()=>{
  location.href = upi;
};

window.done = ()=>{
  onAuthStateChanged(auth, async(user)=>{
    if(!user){
      alert("Login required");
      return;
    }
    await addDoc(collection(db,"payments"),{
      uid:user.uid,
      amount:Number(amount),
      spins:Number(spins),
      status:"pending",
      createdAt:serverTimestamp()
    });
    alert("✅ Payment submitted. Spins will be added after admin approval.");
    location.href="dashboard.html";
  });
};
</script>

</body>
</html>
